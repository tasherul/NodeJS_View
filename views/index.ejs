<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Project</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet"
        id="bootstrap-css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.23/css/jquery.dataTables.css">
    <link rel="stylesheet" type="text/css"
        href="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/10.15.5/sweetalert2.min.css">

    <style>
        body {
            font-family: "Lato", sans-serif;
        }

        .main-head {
            height: 150px;
            background: #FFF;

        }

        .sidenav {
            height: 100%;
            background-color: #538543d6;
            overflow-x: hidden;
            padding-top: 20px;
        }


        .main {
            padding: 0px 10px;
        }

        @media screen and (max-height: 450px) {
            .sidenav {
                padding-top: 15px;
            }
        }

        @media screen and (max-width: 450px) {
            .login-form {
                margin-top: 10%;
            }

            .register-form {
                margin-top: 10%;
            }
        }

        @media screen and (min-width: 768px) {
            .main {
                margin-left: 40%;
            }

            .sidenav {
                /* width: 40%; */
                position: fixed;
                z-index: 1;
                top: 0;
                left: 0;
            }

            .login-form {
                margin-top: 80%;
            }

            .register-form {
                margin-top: 20%;
            }
        }


        .login-main-text {
            margin-top: 20%;
            padding: 60px;
            color: #fff;
        }

        .login-main-text h2 {
            font-weight: 300;
        }

        .btn-black {
            background-color: #000 !important;
            color: #fff;
        }
    </style>
</head>

<body>


    <div class="bs-example">
        <div id="myModal" class="modal fade" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Create Question</h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <p>Question Title</p>
                        <p class="text-secondary"><input oninput="_typequestion(this.value)" type="text"
                                placeholder="type your question.." id="txtquestion" class="form-control"></p>
                        <p class="text-secondary">Enable: <input type="radio" checked id="rbEnable"
                                name="as" />&nbsp;&nbsp;&nbsp; Disable: <input id="rbDisable" type="radio" name="as" />
                        </p>
                        <div class="form-group " id="lblquestion_result"></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="button" onclick="_save_qustion()" class="btn btn-primary">Save changes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="bs-example">
        <div id="myModal2" class="modal fade" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Update Question</h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <p>Question Title</p>
                        <p class="text-secondary"><input oninput="_typequestion2(this.value)" type="text"
                                placeholder="type your question.." id="txtupdatequestion" class="form-control"></p>
                        <p class="text-secondary">Enable: <input type="radio" id="rbupdateEnable"
                                name="s" />&nbsp;&nbsp;&nbsp; Disable: <input id="rbupdateDisable" type="radio"
                                name="s" />
                        </p>
                        <div class="form-group " id="lblupdatequestion_result"></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="button" onclick="_update_qustion()" class="btn btn-primary">Update</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="pnl_login">
        <div class="sidenav">
            <div class="login-main-text">
                <h2>Node js Application</h2>
                <p>Login and see details.</p>
            </div>
        </div>

        <div class="main">
            <div class="col-md-6 col-sm-12">
                <div class="login-form">

                    <div class="form-group">
                        <label>User Name</label>
                        <input type="text" id="txtusername" class="form-control" placeholder="User Name">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="txtpassword" class="form-control" placeholder="Password">
                    </div>
                    <div class="form-group">
                        <button type="submit" id="btnlogin" class="btn btn-success">Login</button>
                    </div>
                    <div class="form-group " id="lblLogin_result">
                        <!-- <a class="alert alert-danger">adasd asd asd asd asd asd sds</a> -->
                    </div>
                </div>

            </div>

        </div>

    </div>
    <div id="pnl_view">
        <div class="row">
            <div class="col-md-4 text-center" style="background-color: #538543d6; height: 100vh;">

                <h2 style="margin-top: 80%; color:#fff;" id="lblName">Dashboard</h2>
                <p style="color: #FFF;">System is ready to use.</p>
                <p style="color: #FFF;">@Tashrul islam</p>

                <button class="btn btn-danger" id="btnlogout">Logout</button>
            </div>
            <div class="col-md-8">
                <div class="row" style="background-color: #538543d6;">
                    <div class="col-md-12 text-center">
                        <h3 style="padding: 20px 0px;color: #FFF;">Questions</h3>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12 text-right"
                        style="padding-top: 20px; padding-bottom:20px; padding-right: 20px;">
                        <button class="btn btn-info" id="btncreate">Create Question</button>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">

                        <table id="myajaxtable" style="width: 100%;" class="display table-response">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Question</th>
                                    <th>Created By</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>
    </div>





</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.js"></script>
<script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/10.15.5/sweetalert2.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script>
    var __id;
    const __base__url = "http://localhost:3001/";
    const __ID_username = 'txtusername';
    const __ID_password = 'txtpassword';
    const __ID_loginResult = 'lblLogin_result';
    const __ID_After_Login = 'pnl_view';
    const __ID_Before_Login = 'pnl_login';
    const __ID_FullName = 'lblName';
    const __ID_Btn_Cretate = 'btncreate';
    const __ID_txtquestion = 'txtquestion';
    const __ID_rbEnable = 'rbEnable';
    const __ID_rbDisable = 'rbDisable';
    const __ID_lblquestion_result = 'lblquestion_result';

    const __ID_txtupdatequestion = 'txtupdatequestion';
    const __ID_rbupdateDisable = 'rbupdateDisable';
    const __ID_lblupdatequestion_result = 'lblupdatequestion_result';
    const __ID_rbupdateEnable = 'rbupdateEnable';




    window.addEventListener('load', (event) => {

        _default();
        btnlogin.addEventListener("click", login_process, false);
        btncreate.addEventListener("click", createQuestion, false);
        btnlogout.addEventListener("click", logout, false);

    });

    function createQuestion() {
        $("#myModal").modal('show');

    }
    function eraseCookie(name) {
        document.cookie = name + '=; Max-Age=-99999999;';
    }
    function logout() {
        eraseCookie('_ses_');

        popup('success', 'Successfully Logout', '');

        setTimeout(function () {
            window.location.reload(1);
        }, 1500);
    }
    function _update_qustion() {
        var question = val(__ID_txtupdatequestion);
        if (question != '') {

            var isactive = _id(__ID_rbupdateEnable).checked;

            $.ajax({
                type: 'POST',
                url: __base__url + 'update',
                contentType: 'application/json',
                dataType: 'JSON',
                data: JSON.stringify({
                    "token": getCookie('_ses_'),
                    "question": question,
                    "isactive": isactive,
                    "Uuid": _uuid
                }),
                error: function (xhr, status, error) {
                    var errorMessage = xhr.status + ': ' + xhr.statusText;
                    //alert(errorMessage);
                    message(__ID_lblupdatequestion_result, 'error', errorMessage);

                },
                success: function (data) {
                    $("#myModal").modal('hide');
                    popup('success', 'Question Update', '');

                }
            });


            setTimeout(function () {
                window.location.reload(1);
            }, 1500);
        }
        else {
            _id(__ID_txtupdatequestion).style.border = "2px solid red";
            message(__ID_lblupdatequestion_result, 'error', 'Type your question then submit.');
        }

    }
    function _typequestion2(value) {
        if (value.length > 0) {
            _id(__ID_txtupdatequestion).style.border = "2px solid green";
            message(__ID_lblupdatequestion_result, 'success', 'Now you may procced to submit question.');
        }
        else {
            _id(__ID_txtupdatequestion).style.border = "2px solid red";
            message(__ID_lblupdatequestion_result, 'error', 'Type your question then submit.');
        }

    }

    function _save_qustion() {
        var question = val(__ID_txtquestion);
        if (question != '') {

            var isactive = _id(__ID_rbEnable).checked;

            $.ajax({
                type: 'POST',
                url: __base__url + 'submit',
                contentType: 'application/json',
                dataType: 'JSON',
                data: JSON.stringify({
                    "token": getCookie('_ses_'),
                    "question": question,
                    "isactive": isactive
                }),
                error: function (xhr, status, error) {
                    var errorMessage = xhr.status + ': ' + xhr.statusText;
                    //alert(errorMessage);
                    message(__ID_lblquestion_result, 'error', errorMessage);

                },
                success: function (data) {
                    $("#myModal").modal('hide');
                    popup('success', 'Question submit', '');

                }
            });


            setTimeout(function () {
                window.location.reload(1);
            }, 1500);
        }
        else {
            _id(__ID_txtquestion).style.border = "2px solid red";
            message(__ID_lblquestion_result, 'error', 'Type your question then submit.');
        }

    }
    function _default() {
        $('#' + __ID_loginResult).hide();
        $('#' + __ID_After_Login).hide();
        var token = getCookie('_ses_');
        if (token != false) {
            $('#' + __ID_Before_Login).hide();
            $('#' + __ID_After_Login).fadeIn();
            _token_to_id(token);
            _show_qustions();
        }
    }
    function _typequestion(value) {
        if (value.length > 0) {
            _id(__ID_txtquestion).style.border = "2px solid green";
            message(__ID_lblquestion_result, 'success', 'Now you may procced to submit question.');
        }
        else {
            _id(__ID_txtquestion).style.border = "2px solid red";
            message(__ID_lblquestion_result, 'error', 'Type your question then submit.');
        }

    }
    function _token_to_id(token) {
        $.ajax({
            type: 'POST',
            url: __base__url + 'ids',
            contentType: 'application/json',
            dataType: 'JSON',
            data: JSON.stringify({
                "token": token,
            }),
            error: function (xhr, status, error) {
                var errorMessage = xhr.status + ': ' + xhr.statusText;
                alert(errorMessage);
                //message(__ID_loginResult, 'error', errorMessage);
            },
            success: function (data) {
                _id(__ID_FullName).innerHTML = data.name;
                __id = data.id;
            }
        });
    }

    function _show_qustions() {

        var dts = [];
        var dt;

        $.ajax({
            type: 'POST',
            url: __base__url + 'getlist',
            contentType: 'application/json',
            dataType: 'JSON',
            data: JSON.stringify({
                "token": getCookie('_ses_'),
            }),
            error: function (xhr, status, error) {
                var errorMessage = xhr.status + ': ' + xhr.statusText;
                //alert(errorMessage);
                //message(__ID_loginResult, 'error', errorMessage);
                popup('error', 'Error', errorMessage);
            },
            success: function (ret) {
                // var x = JSON.parse(data.return);
                var val = ret.return;
                dt = val;

                for (var i = 0; i < val.length; i++) {

                    dts.push([
                        i + 1,
                        val[i].question,
                        val[i].createdby,
                        val[i].active == 'Active' ? '<a style="color:#fff" class="btn btn-success">Active</a>' : '<a style="color:#fff" class="btn btn-warning">Inctive</a>',
                        '<a style="color:#fff" onclick="_questionfind(\'' + val[i].uuid + '\')" class="btn btn-primary">Edit</a>\
                         <a style="color:#fff" onclick="_questiondelete(\''+ val[i].uuid + '\')" class="btn btn-danger">Delete</a>'
                    ]);
                }


                $('#myajaxtable').DataTable({
                    data: dts
                });

            }
        });

        //alert(JSON.stringify(dt));
    }
    var _uuid;
    function _questionfind(uuid) {
        $("#myModal2").modal('show');
        _uuid = uuid;
        $.ajax({
            type: 'POST',
            url: __base__url + 'find',
            contentType: 'application/json',
            dataType: 'JSON',
            data: JSON.stringify({
                "Uuid": uuid,
            }),
            error: function (xhr, status, error) {
                var errorMessage = xhr.status + ': ' + xhr.statusText;
                alert(errorMessage);
                //message(__ID_loginResult, 'error', errorMessage);
            },
            success: function (data) {
                var view = data.return;
                $('#' + __ID_txtupdatequestion).val(view[0].question);
                if (view[0].IsActive)
                    _id(__ID_rbupdateEnable).checked = true;
                else
                    _id(__ID_rbupdateDisable).checked = true;
            }
        });
    }
    function _questiondelete(uuid) {
        Swal.fire({
            title: 'Are you sure?',
            text: "You want to delete this question!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    type: 'POST',
                    url: __base__url + 'delete',
                    contentType: 'application/json',
                    dataType: 'JSON',
                    data: JSON.stringify({
                        "Uuid": uuid
                    }),
                    error: function (xhr, status, error) {
                        var errorMessage = xhr.status + ': ' + xhr.statusText;
                        alert(errorMessage);
                        //message(__ID_loginResult, 'error', errorMessage);
                    },
                    success: function (data) {

                        Swal.fire(
                            'Deleted!',
                            'Your question has been deleted.',
                            'success'
                        )

                        setTimeout(function () {
                            window.location.reload(1);
                        }, 1500);


                    }
                });
            }


        })
        //alert(uuid);
    }
    function popup(option, message, _title) {
        if (option === 'success') {
            Swal.fire({
                position: 'top-end',
                icon: 'success',
                title: message,
                showConfirmButton: false,
                timer: 1500
            })
        }
        else {
            Swal.fire({
                icon: 'error',
                title: _title,
                text: message,
                //footer: '<a href>Why do I have this issue?</a>'
            })
        }
    }
    function login_process() {
        var username = val(__ID_username);
        var password = val(__ID_password);
        if (username == null || username == "")
            _id(__ID_username).style.border = "2px solid red";
        if (password == null || password == "")
            _id(__ID_password).style.border = "2px solid red";

        if (username != '' && password != '')
            _login_process(username, password);
        else
            message(__ID_loginResult, 'error', 'Type Usernam/ Password.');
    }
    function _login_process(username, password) {

        $.ajax({
            type: 'POST',
            url: __base__url + 'login',
            contentType: 'application/json',
            dataType: 'JSON',
            data: JSON.stringify({
                "UserName": username,
                "Password": password
            }),
            error: function (xhr, status, error) {
                var errorMessage = xhr.status + ': ' + xhr.statusText;
                //alert(errorMessage);
                message(__ID_loginResult, 'error', errorMessage);
            },
            success: function (data) {
                var val = JSON.parse(data.request);

                if (val.return != false) {
                    //message(__ID_loginResult, 'success', val.message);
                    popup('success', 'Successfully Login', '');
                    setCookie('_ses_', val.return, 1);
                    _token_to_id(val.return);
                    $('#' + __ID_Before_Login).hide();
                    $('#' + __ID_After_Login).fadeIn();
                    _show_qustions();

                }
                else {
                    message(__ID_loginResult, 'error', val.message);
                }

            }
        });

    }
    function message(id, opt, message) {
        if (opt === "success")
            _id(id).innerHTML = "<a class='alert alert-success form-control'>" + _msg(message) + "</a>";
        if (opt === "error")
            _id(id).innerHTML = "<a class='alert alert-danger form-control'>" + _msg(message) + "</a>";
        if (opt === "warning")
            _id(id).innerHTML = "<a class='alert alert-warning form-control'>" + _msg(message) + "</a>";
        if (opt === "info")
            _id(id).innerHTML = "<a class='alert alert-info form-control'>" + _msg(message) + "</a>";

        $('#' + __ID_loginResult).fadeIn();
    }
    function _msg(message) {
        if (Array.isArray(message)) {
            var __rt = "<ul>";
            for (var i = 0; i < message.length; i++) {
                __rt += '<li>' + message[i] + '</li>';
            }
            return __rt + '</ul>'
        }
        else {
            return message;
        }
    }
    function val(id) {
        return document.getElementById(id).value;
    }
    function _id(id) {
        return document.getElementById(id);
    }


    function x() {
        $.ajax({
            type: 'GET',
            url: __base__url + 'api',
            dataType: 'JSON',
            error: function (xhr, status, error) {
                var errorMessage = xhr.status + ': ' + xhr.statusText;
                alert(errorMessage);
            },
            success: function (data) {
                alert(JSON.stringify(data));
            }
        });
    }

    function __(Methord, URL, DATA) {
        $.ajax({
            type: Methord,
            url: __base__url + URL,
            dataType: 'JSON',
            data: DATA,
            error: function (xhr, status, error) {
                var errorMessage = xhr.status + ': ' + xhr.statusText;
                return errorMessage;
            },
            success: function (data) {
                return data;
            }
        });
    }

    function setCookie(cname, cvalue, exdays) {
        var d = new Date();
        d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
        var expires = "expires=" + d.toGMTString();
        document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
    }

    function getCookie(cname) {
        var name = cname + "=";
        var decodedCookie = decodeURIComponent(document.cookie);
        var ca = decodedCookie.split(';');
        for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
            }
        }
        return false;
    }

</script>

</html>